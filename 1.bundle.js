(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(t,e,s){"use strict";function i(t){const e=new Array(t);return e.fill(0),e}function n(t){return t.slice()}function r(t,e){for(let s=0;s<t.length;s++)t[s]*=e}function o(t,e){if(t.length!==e.length)return void console.error("Vec.dot: mismatched vector lengths");let s=0;for(let i=0;i<t.length;i++)s+=t[i]*e[i];return s}function a(t){return Math.sqrt(o(t,t))}function h(t){const e=o(t,t);e>Number.EPSILON?r(t,1/Math.sqrt(e)):t.fill(0)}function c(t,e,s){const i=1-s**2,n=t.reduce((t,s,i)=>i===e?t:t+s**2,0);if(n>Number.EPSILON){r(t,Math.sqrt(i/n))}else{const e=Math.sqrt(i/(t.length-1));t.fill(-e)}t[e]=s}function l(t,e){if(t.length!==e.length)return void console.error("Vec.add: mismatched vector lengths");const s=n(t);for(let i=0;i<t.length;i++)s[i]+=e[i];return s}function u(t,e){if(t.length!==e.length)return void console.error("Vec.sub: mismatched vector lengths");const s=n(t);for(let i=0;i<t.length;i++)s[i]-=e[i];return s}function f(t,e,s,i){const o=n(e);r(o,t);const a=n(i);return r(a,s),l(o,a)}function d(t,e){const s=n(e);return r(s,o(t,e)),u(t,s)}function g(t,e,s,i){const n=Math.cos(i),r=Math.sin(i),o=t[e],a=t[s];t[e]=n*o-r*a,t[s]=r*o+n*a}s.r(e);const m=1e3*Number.EPSILON;class p{constructor(t,e){this.state=t,this.checkAxes=e,this.cache=new Map}makeVertex(t){return{coord:t,pcoord:this.state.project(t),inCut:this.checkAxes.cutCheck(t),seen:!1}}get(t){const e=t.toString();let s=this.cache.get(e);return s||(s=this.makeVertex(t),this.cache.set(e,s)),s}getNeighbor(t,e,s){const i=n(t.coord);return i[e]+=s,this.get(i)}}function v(t,e,s){const i=new b(t),n=new p(t,i),r=[],o=1.5+e/2,a=1.5+s/2,h=[n.get(t.offset.map(Math.floor))];for(let e=0;e<t.dims;e++)h.push(...h.map(t=>n.getNeighbor(t,e,1)));const c=h.filter(t=>t.inCut);for(;c.length>0&&r.length<2e4;){const e=c.pop();if(!e.seen&&(e.seen=!0,!(!e.inCut||Math.abs(e.pcoord[0])>o||Math.abs(e.pcoord[1])>a))){r.push(e);for(let s=0;s<t.dims;s++)for(let t of[-1,1]){const i=n.getNeighbor(e,s,t);i.seen||c.push(i)}}}const l=[];return r.forEach(e=>{for(let s=0;s<t.dims;s++){const i=n.getNeighbor(e,s,1);if(i.inCut)for(let r=s+1;r<t.dims;r++){const t=n.getNeighbor(e,r,1),o=n.getNeighbor(i,r,1);t.inCut&&o.inCut&&l.push({keyVert:e.pcoord,axis1:s,axis2:r})}}}),l}class b{constructor(t){this.checkAxes=[];for(let e=0;e<t.dims-2;e++)for(let s=e+1;s<t.dims-1;s++)for(let n=s+1;n<t.dims;n++){const r=i(t.dims);r[e]=t.basis[0][n]*t.basis[1][s]-t.basis[0][s]*t.basis[1][n],r[s]=t.basis[0][e]*t.basis[1][n]-t.basis[0][n]*t.basis[1][e],r[n]=t.basis[0][s]*t.basis[1][e]-t.basis[0][e]*t.basis[1][s],Math.abs(r[e])<=Number.EPSILON&&(r[e]=0),Math.abs(r[s])<=Number.EPSILON&&(r[s]=0),Math.abs(r[n])<=Number.EPSILON&&(r[n]=0),h(r),0!==a(r)&&this.checkAxes.push(r)}const e=function(t){const e=[],s=i(t),r=function(t){t>0?(s[t-1]=.5,r(t-1),s[t-1]=-.5,r(t-1)):e.push(n(s))};return r(t),e}(t.dims).map(e=>l(e,t.offset));this.checkMax=[],this.checkMin=[],this.checkAxes.forEach(t=>{let s=-1/0,i=1/0;e.forEach(e=>{const n=o(e,t);s=Math.max(s,n),i=Math.min(i,n)}),this.checkMax.push(s),this.checkMin.push(i)})}cutCheck(t){return this.checkAxes.every((e,s)=>{const i=o(t,e);return i-this.checkMin[s]>m&&this.checkMax[s]-i>=-m})}cutStatus(t){return this.checkAxes.map((e,s)=>{const i=o(t,e);return Math.abs(this.checkMax[s]-i)<=m?"+":Math.abs(i-this.checkMin[s])<=m?"-":this.checkMin[s]<i&&i<this.checkMax[s]?"=":"_"}).join("")}}function y(t,e,s){const i=[];for(let e=0;e<t.dims;e++)i.push([t.basis[0][e],t.basis[1][e]]);const n=function(t){const e=[];for(let s=0;s<t.length;s++){e.push([]);for(let i=0;i<=s;i++)s===i?e[s][s]=0:(e[s][i]=t[s][0]*t[i][1]-t[i][0]*t[s][1],e[i][s]=-e[s][i])}return e}(i),r=e/2+Math.SQRT1_2,o=s/2+Math.SQRT1_2,a=function(t,e,s){const i=[t.unproject([-e,-s]),t.unproject([-e,s]),t.unproject([e,-s]),t.unproject([e,s])],n=[],r=[];for(let e=0;e<t.dims;e++)n.push(i.reduce((t,s)=>Math.min(t,Math.floor(s[e])),1/0)),r.push(i.reduce((t,s)=>Math.max(t,Math.ceil(s[e])),-1/0));return{min:n,max:r}}(t,r,o),h=[];for(let e=0;e<t.dims-1;e++)for(let s=e+1;s<t.dims;s++)if(!(Math.abs(n[e][s])<Number.EPSILON))for(let c=a.min[e];c<a.max[e];c++)for(let l=a.min[s];l<a.max[s];l++){const a=x(e,s,c,l,t,i,n),u=t.project(a),f=u[0]+(i[e][0]+i[s][0])/2,d=u[1]+(i[e][1]+i[s][1])/2;Math.abs(f)>r||Math.abs(d)>o||h.push({keyVert:u,axis1:e,axis2:s})}return h}function x(t,e,s,i,n,r,a){const h=s+.5-n.offset[t],c=i+.5-n.offset[e],l=(h*r[e][1]-c*r[t][1])/a[t][e],u=(c*r[t][0]-h*r[e][0])/a[t][e];return n.unproject([l,u]).map((n,h)=>h===t?s:h===e?i:Math.abs(n-Math.floor(n)-.5)>1e-10?Math.round(n):function(t,e,s,i,n){return Math.abs(n[t][s])<Number.EPSILON?o(i[s],i[t])>0&&s<t:Math.abs(n[s][e])<Number.EPSILON?o(i[s],i[e])>0&&s<e:n[t][e]*n[t][s]>0&&n[t][e]*n[s][e]>0}(t,e,h,r,a)?Math.ceil(n):Math.floor(n))}function w(t){return Math.max(0,Math.min(255,Math.round(t))).toString(16).padStart(2,"0")}function k([t,e,s]){return`#${w(t)}${w(e)}${w(s)}`}function A(t,e){return[t.getUint8(e),t.getUint8(e+1),t.getUint8(e+2)]}function M(t){const e=t.match(/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})/i);if(null!==e){return[Number.parseInt(e[1],16),Number.parseInt(e[2],16),Number.parseInt(e[3],16)]}return[0,0,0]}class E{constructor(t){this.gl=t,this.programInfo=this.initShaders(5)}render(t,e,s){this.programInfo.shaderDims!==t.dims&&(this.programInfo=this.initShaders(t.dims));const i=this.initBuffers(6*e.length);this.drawFaces(i,e,t),this.bufferData(i);const n=this.initUniforms(t,s);this.drawScene(i,n,t.lineColor)}initShaders(t){const e=`\n            const int MAX_DIMS = ${t};\n\n            attribute vec2 aVertexPosition;\n            attribute vec3 aVertexColor;\n            attribute vec2 aFaceAxis;\n            attribute vec2 aFacePosition;\n\n            uniform vec2 uScalingFactor;\n            uniform vec2 uAxis[MAX_DIMS];\n\n            varying lowp vec3 vColor;\n\n            void main() {\n                mat2 face_basis = mat2(uAxis[int(aFaceAxis[0])], uAxis[int(aFaceAxis[1])]);\n                vec2 v = aFacePosition + face_basis * aVertexPosition;\n                gl_Position = vec4(v * uScalingFactor, 0.0, 1.0);\n                vColor = aVertexColor / 255.0;\n            }\n        `,s=function(t,e,s){const i=C(t,t.VERTEX_SHADER,e),n=C(t,t.FRAGMENT_SHADER,s),r=t.createProgram();if(t.attachShader(r,i),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))return alert("Unable to initialize the shader program: "+t.getProgramInfoLog(r)),null;return r}(this.gl,e,"\n            varying lowp vec3 vColor;\n\n            void main() {\n                gl_FragColor = vec4(vColor, 1.0);\n            }\n        ");return{program:s,shaderDims:t,attribLocations:{vertexPosition:this.gl.getAttribLocation(s,"aVertexPosition"),vertexColor:this.gl.getAttribLocation(s,"aVertexColor"),faceAxis:this.gl.getAttribLocation(s,"aFaceAxis"),facePosition:this.gl.getAttribLocation(s,"aFacePosition")},uniformLocations:{scalingFactor:this.gl.getUniformLocation(s,"uScalingFactor"),axis:this.gl.getUniformLocation(s,"uAxis")}}}initBuffers(t){return{vertexCount:t,vertexPosition:new L(this.gl,t,2),color:new L(this.gl,t,3),axis:new L(this.gl,t,2),facePos:new L(this.gl,t,2)}}bufferData(t){t.vertexPosition.bufferData(),t.color.bufferData(),t.axis.bufferData(),t.facePos.bufferData()}enableBuffers(t){t.vertexPosition.enable(this.programInfo.attribLocations.vertexPosition),t.color.enable(this.programInfo.attribLocations.vertexColor),t.axis.enable(this.programInfo.attribLocations.faceAxis),t.facePos.enable(this.programInfo.attribLocations.facePosition)}initUniforms(t,e){const s=[];for(let e=0;e<t.dims;e++)s.push(t.basis[0][e]),s.push(t.basis[1][e]);return{axis:s,scalingFactor:[2*e/this.gl.canvas.width,-2*e/this.gl.canvas.height]}}setUniforms(t){this.gl.uniform2fv(this.programInfo.uniformLocations.scalingFactor,t.scalingFactor),this.gl.uniform2fv(this.programInfo.uniformLocations.axis,t.axis)}drawFaces(t,e,s){const i=s.getInsets();e.forEach(e=>{this.drawFace(t,e,s,i)})}drawFace(t,e,s,i){const n=s.getColor(e.axis1,e.axis2),r=s=>{t.vertexPosition.push(s[0]),t.vertexPosition.push(s[1]),t.color.push(n[0]),t.color.push(n[1]),t.color.push(n[2]),t.axis.push(e.axis1),t.axis.push(e.axis2),t.facePos.push(e.keyVert[0]),t.facePos.push(e.keyVert[1])},o=i[e.axis1][e.axis2],a=i[e.axis2][e.axis1],h=[[0+o,0+a],[1-o,0+a],[1-o,1-a],[0+o,1-a]];r(h[0]),r(h[1]),r(h[2]),r(h[0]),r(h[2]),r(h[3])}drawScene(t,e,s){const i=this.gl;i.viewport(0,0,i.canvas.width,i.canvas.height),i.clearColor(s[0],s[1],s[2],1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this.enableBuffers(t),i.useProgram(this.programInfo.program),this.setUniforms(e);i.drawArrays(i.TRIANGLES,0,t.vertexCount)}}function C(t,e,s){const i=t.createShader(e);return t.shaderSource(i,s),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(alert("An error occurred compiling the shaders: "+t.getShaderInfoLog(i)),t.deleteShader(i),null)}class L{constructor(t,e,s){this.gl=t,this.numComponents=s,this.type=t.FLOAT,this.normalize=!1,this.stride=0,this.offset=0,this.buffer=t.createBuffer(),this.array=new Float32Array(e*s),this.ix=0}bufferData(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.array,this.gl.STATIC_DRAW)}enable(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.vertexAttribPointer(t,this.numComponents,this.type,this.normalize,this.stride,this.offset),this.gl.enableVertexAttribArray(t)}push(t){this.ix<this.array.length&&(this.array[this.ix++]=t)}}const _=[0,0,0];class S extends class{constructor(t){this.dims=t,this.resetBasis(),this.resetOffset()}resetBasis(){this.basis=[i(this.dims),i(this.dims)];const t=Math.sqrt(2/this.dims),e=(this.dims%2+1)*Math.PI/this.dims;for(let s=0;s<this.dims;s++)this.basis[0][s]=t*Math.cos(e*s),this.basis[1][s]=t*Math.sin(e*s)}basisTest(){console.debug("--------------------"),console.debug("|u| =",a(this.basis[0])),console.debug("|v| =",a(this.basis[1])),console.debug("u . v =",o(this.basis[0],this.basis[1]))}resetOffset(){const t=5===this.dims?.3:0;this.offset=new Array(this.dims),this.offset.fill(t)}project(t){return function(t,e){const s=i(e.length);for(let i=0;i<e.length;i++)s[i]=o(t,e[i]);return s}(u(t,this.offset),this.basis)}unproject(t){return l(f(t[0],this.basis[0],t[1],this.basis[1]),this.offset)}translateOffset(t,e){this.offset=this.unproject([t,e]).map(t=>t-Math.floor(t))}moveAxis(t,e,s){let i=e,n=s,r=Math.hypot(e,s);r<=Number.EPSILON?(i=1,n=0,r=0):(i/=r,n/=r,r=Math.min(r,1));let o=this.basis[0],a=this.basis[1];const h=f(i,o,n,a),l=f(-n,o,i,a);o=h,a=l,c(a,t,0),o=d(o,a),c(o,t,r),this.basis[0]=f(i,o,-n,a),this.basis[1]=f(n,o,i,a)}validate(){h(this.basis[0]),this.basis[1]=d(this.basis[1],this.basis[0]),h(this.basis[1]),0!==a(this.basis[0])&&0!==a(this.basis[1])||this.resetBasis();for(let t=0;t<this.dims;t++)this.offset[t]=Math.max(0,Math.min(1,this.offset[t]))}}{constructor(t){super(t),this.initColors(t),this.faceTypes=function(t){const e=[];for(let s=0;s<t;s++)e.push([]);let s=0;for(let i=0;i<t-1;i++)for(let n=i+1;n<t;n++)e[i][n]=s,e[n][i]=s,s+=1;return e}(t),this.lineColor=_,this.lineWidth=2/60}initColors(t){if(3===t)return void(this.colors=[[128,128,128],[232,232,255],[180,180,192]]);let e=0,s=1;for(let i=1;i<t;i++){const t=Math.abs(this.basis[0][0]*this.basis[0][i]+this.basis[1][0]*this.basis[1][i]);e=Math.max(e,t),s=Math.min(s,t)}this.colors=[];for(let i=0;i<t-1;i++)for(let n=i+1;n<t;n++){const t=this.basis[0][i]*this.basis[0][n]+this.basis[1][i]*this.basis[1][n],r=(Math.abs(t)-s)/(e-s),o=232-104*r,a=232-104*r,h=255-127*r;this.colors.push([o,a,h])}}getColor(t,e){return this.colors[this.faceTypes[t][e]]}getInsets(){const t=this.lineWidth/2,e=[];for(let t=0;t<this.dims;t++)e.push([]);for(let s=0;s<this.dims;s++){const i=this.basis[0][s],n=this.basis[1][s];for(let r=0;r<this.dims;r++)if(s===r)e[s][r]=0;else{const o=this.basis[0][r],a=this.basis[1][r];e[s][r]=t*Math.hypot(o,a)/Math.abs(i*a-n*o),e[s][r]=Math.min(e[s][r],.5)}}return e}genStateCode(t){const e=function(t){const e=2*t.dims,s=t.dims,i=t.colors,n=3*(1+i.length),r=new ArrayBuffer(2+2*e+s+n),o=new DataView(r);o.setUint8(0,1),o.setUint8(1,t.dims);let a=2;return t.basis.forEach(t=>t.forEach(t=>{o.setInt16(a,Math.round(32767*t)),a+=2})),t.offset.forEach(t=>{o.setUint8(a,Math.round(200*t)),a+=1}),t.lineColor.forEach((t,e)=>o.setUint8(a+e,t)),a+=3,i.forEach(t=>{t.forEach((t,e)=>o.setUint8(a+e,t)),a+=3}),new Blob([r])}(this),s=new FileReader;s.addEventListener("loadend",()=>{const e=s.result.split(",")[1];console.log("generated state code:",e),t(e)},!1),s.readAsDataURL(e)}}function I(t,e){const s=function(t){const e=atob(t),s=new Uint8Array(e.length);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return new Blob([s])}(t),i=new FileReader;i.addEventListener("loadend",()=>{const t=function(t){try{const e=new DataView(t);if(1!==e.getUint8(0))return console.error("Tiling state decode: invalid format"),null;const s=e.getUint8(1);if(s<3||s>7)return console.error("Tiling state decode: unsupported dimension"),null;let i=2;const n=[];for(let t=0;t<2;t++){const t=[];for(let n=0;n<s;n++)t.push(e.getInt16(i)/32767),i+=2;n.push(t)}const r=[];for(let t=0;t<s;t++)r.push(e.getUint8(i)/200),i+=1;const o=A(e,i);i+=3;const a=[];for(let t=0;t<s*(s-1)/2;t++)a.push(A(e,i)),i+=3;return{dims:s,basis:n,offset:r,lineColor:o,colors:a}}catch(t){if(t instanceof RangeError)return console.error("Tiling state decode: invalid state code (RangeError)"),null;throw t}}(i.result);if(t){const s=new S(t.dims);s.basis=t.basis,s.offset=t.offset,s.colors=t.colors,s.lineColor=t.lineColor,s.validate(),e(s)}else console.error("Failed decoding state code.")},!1),i.readAsArrayBuffer(s)}class B{constructor(t,e){this.canvas=t,this.app=e,this.tracking=null,this.scale=60,t.width=t.clientWidth,t.height=t.clientHeight,t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1),t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1),t.addEventListener("wheel",this,{passive:!0}),window.addEventListener("resize",this,!1);const s=this.canvas.getContext("webgl");if(null!==s)this.renderer=new E(s);else{const t=this.canvas.getContext("2d");this.renderer=null!==t?new P(t):{render(){console.error("no rendering context")}}}}draw(t,e){const s=e(t,this.canvas.width/this.scale,this.canvas.height/this.scale);this.renderer.render(t,s,this.scale)}handleEvent(t){switch(t.type){case"mousedown":this.tracking={x:t.offsetX,y:t.offsetY};break;case"mousemove":this.tracking&&this.mouseMove(t.offsetX,t.offsetY);break;case"mouseup":this.tracking=null;break;case"touchstart":this.touchStart(t);break;case"touchmove":this.touchMove(t);break;case"touchend":this.tracking=null;break;case"wheel":this.wheelMove(t);break;case"resize":this.resize()}}mouseMove(t,e){this.viewMove(this.tracking.x-t,this.tracking.y-e),this.tracking.x=t,this.tracking.y=e}wheelMove(t){this.viewZoom(t.deltaY>0?.8:1.25)}touchStart(t){t.preventDefault(),this.tracking||(this.tracking=[]);for(let e=0;e<t.changedTouches.length;e++){const s=t.changedTouches[e];if(this.tracking.touch0){if(this.tracking.touch1)break;this.tracking.touch1={id:s.identifier,x:s.pageX,y:s.pageY},this.tracking.dist=Math.hypot(this.tracking.touch0.x-this.tracking.touch1.x,this.tracking.touch0.y-this.tracking.touch1.y)}else this.tracking.touch0={id:s.identifier,x:s.pageX,y:s.pageY}}}touchMove(t){if(this.tracking){t.preventDefault();let e=!1;for(let s=0;s<t.changedTouches.length;s++){const i=t.changedTouches[s];this.tracking.touch0.id===i.identifier?(this.tracking.touch0.lastX=this.tracking.touch0.x,this.tracking.touch0.lastY=this.tracking.touch0.y,this.tracking.touch0.x=i.pageX,this.tracking.touch0.y=i.pageY,e=!0):this.tracking.touch1.id===i.identifier&&(this.tracking.touch1.x=i.pageX,this.tracking.touch1.y=i.pageY,e=!0)}if(e)if(this.tracking.touch1){const t=Math.hypot(this.tracking.touch0.x-this.tracking.touch1.x,this.tracking.touch0.y-this.tracking.touch1.y);0!==this.tracking.dist&&this.viewZoom(t/this.tracking.dist),this.tracking.dist=t}else this.viewMove(this.tracking.touch0.lastX-this.tracking.touch0.x,this.tracking.touch0.lastY-this.tracking.touch0.y)}}viewMove(t,e){this.app.translateOffset(t/this.scale,e/this.scale)}viewZoom(t){const e=this.scale;t>1?this.scale=Math.min(290,Math.ceil(this.scale*t)):t<1&&(this.scale=Math.max(30,Math.floor(this.scale*t))),this.scale!==e&&this.app.redraw()}resize(){this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.app.redraw()}}class P{constructor(t){this.ctx=t}render(t,e,s){const i=this.ctx;i.clearRect(0,0,i.canvas.width,i.canvas.height),i.save(),i.translate(i.canvas.width/2,i.canvas.height/2),i.scale(s,s),i.lineWidth=t.lineWidth,i.lineJoin="bevel",i.strokeStyle=k(t.lineColor),e.forEach(e=>{i.fillStyle=k(t.getColor(e.axis1,e.axis2));const s=[t.basis[0][e.axis1],t.basis[1][e.axis1]],n=[t.basis[0][e.axis2],t.basis[1][e.axis2]];i.translate(e.keyVert[0],e.keyVert[1]),i.beginPath(),i.moveTo(0,0),i.lineTo(s[0],s[1]),i.lineTo(s[0]+n[0],s[1]+n[1]),i.lineTo(n[0],n[1]),i.closePath(),i.fill(),i.stroke(),i.translate(-e.keyVert[0],-e.keyVert[1])}),i.restore()}}class O{constructor(t,e){this.x=t,this.y=e}draw(t){t.beginPath(),t.arc(this.x,this.y,4/60,0,2*Math.PI),t.fill()}contains(t,e){const s=t-this.x,i=e-this.y;return s*s+i*i<(8/60)**2}valueChanged(){}mouseAction(t,e){this.x=t,this.y=e,this.valueChanged()}}class T{constructor(t,e,s){this.canvas=t,this.app=e,this.tracking=null,t.width=t.clientWidth,t.height=t.clientHeight,t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1),t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1),this.setNumAxes(s)}setNumAxes(t){this.ctls=[];for(let e=0;e<t;e++){const t=new O(0,0);t.valueChanged=()=>{this.app.axisChanged(e,t.x,t.y)},this.ctls.push(t)}}draw(){const t=this.canvas.getContext("2d");t.save(),t.fillStyle="white",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.translate(this.canvas.width/2,this.canvas.height/2),t.scale(60,60),t.lineWidth=1/60,t.strokeStyle="lightgrey",t.beginPath(),t.arc(0,0,Math.sqrt(2/this.ctls.length),0,2*Math.PI),t.stroke(),t.strokeStyle="grey",t.beginPath(),t.arc(0,0,1,0,2*Math.PI),t.stroke(),t.strokeStyle="black",t.beginPath();for(let e=0;e<this.ctls.length;e++){t.moveTo(0,0),t.lineTo(this.ctls[e].x,this.ctls[e].y);const s=(e+1)%this.ctls.length;t.lineTo(this.ctls[e].x+this.ctls[s].x,this.ctls[e].y+this.ctls[s].y),t.lineTo(this.ctls[s].x,this.ctls[s].y)}t.stroke(),t.fillStyle="black",this.ctls.forEach(e=>{e.draw(t)}),t.restore()}handleEvent(t){switch(t.type){case"mousedown":this.mouseDown(t);break;case"mousemove":this.mouseMove(t);break;case"mouseup":this.tracking=null;break;case"touchstart":this.touchStart(t);break;case"touchmove":this.touchMove(t);break;case"touchend":this.tracking=null}}toLocalPos(t,e){return{x:(t-this.canvas.width/2)/60,y:(e-this.canvas.height/2)/60}}findControl(t,e){const s=this.toLocalPos(t,e);return this.ctls.find(t=>t.contains(s.x,s.y))}mouseAction(t,e,s){const i=this.toLocalPos(e,s);t.mouseAction(i.x,i.y)}mouseDown(t){this.tracking=this.findControl(t.offsetX,t.offsetY)}mouseMove(t){this.tracking&&this.mouseAction(this.tracking,t.offsetX,t.offsetY)}touchStart(t){if(!this.tracking){const e=t.changedTouches[0],s=F(e),i=this.findControl(s.x,s.y);i&&(t.preventDefault(),this.tracking={target:i,identifier:e.identifier})}}touchMove(t){if(this.tracking){t.preventDefault();const e=function(t,e){for(let s=0;s<t.length;s++)if(t[s].identifier===e)return t[s];return null}(t.changedTouches,this.tracking.identifier);if(e){const t=F(e);this.mouseAction(this.tracking.target,t.x,t.y)}}}}function F(t){const e=t.target.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}class N{constructor(t,e,s){this.div=t,this.app=e,this.ctls=[],this.lbls=[],this.setNumAxes(s)}addOffset(){const t=document.createElement("div");this.div.append(t);const e=this.ctls.length,s=document.createElement("input");s.type="range",s.min=0,s.max=1,s.step=.01,this.ctls.push(s),t.append(s);const i=document.createElement("span");i.className="offset-label",this.lbls.push(i),t.append(i),s.addEventListener("input",t=>{i.innerHTML=s.valueAsNumber.toFixed(2),this.app.offsetChanged(e,s.valueAsNumber)})}removeOffset(){this.div.removeChild(this.div.lastChild),this.ctls.pop(),this.lbls.pop()}setNumAxes(t){for(;this.ctls.length>t;)this.removeOffset();for(;this.ctls.length<t;)this.addOffset()}setOffset(t,e){this.ctls[t].valueAsNumber=e,this.lbls[t].innerHTML=e.toFixed(2)}}var R=s(2);function U(t,e,s){const i=R.b(t.dims,t.basis[0],t.basis[1],t.offset,e,s),n=[],r=i.get_num_faces();for(let t=0;t<r;t++){const e=i.get_face(t);n.push({keyVert:[e.key_vert_x,e.key_vert_y],axis1:e.axis1,axis2:e.axis2}),e.free()}return i.free(),n}class D{constructor(){const t=document.getElementById("numAxes");t.addEventListener("change",()=>{this.setState(new S(parseInt(t.value,10)))});const e=parseInt(t.value,10);this.state=new S(e);const s=document.getElementById("main");this.tilingView=new B(s,this);const i=document.getElementById("tileGen");i.addEventListener("change",()=>{this.tilingGen=this.getTilingGen(i.value),this.redraw()}),this.tilingGen=this.getTilingGen(i.value);const n=document.getElementById("axisRosette");this.axisControls=new T(n,this,e),this.updateAxisControls(),V("axisToggle","axisControls");const r=document.getElementById("offsetControls");this.offsetControls=new N(r,this,e),this.updateOffsetControls(),V("offsetToggle","offsetControls"),document.getElementById("offsetControls").style.display="none";document.getElementById("reset").addEventListener("click",()=>{this.state.resetBasis(),this.updateAxisControls(),this.redraw()}),this.initColorControls(e),V("colorToggle","colorControls"),document.getElementById("colorControls").style.display="none",V("aboutToggle","about"),document.getElementById("about").style.display="none",this.animating=!1,this.animTime=-1;const o=document.getElementById("animate");o.addEventListener("click",()=>{this.animating?(this.stopAnimation(),o.value="Animate"):(this.startAnimation(),o.value="Stop animation")});document.getElementById("save").addEventListener("click",()=>{this.state.genStateCode(t=>{const e=document.getElementById("codeCode");e.innerHTML=t,window.getSelection().selectAllChildren(e);document.getElementById("codeLink").href="?a="+t;document.getElementById("codeShow").classList.add("codeActive")})});document.getElementById("codeDone").addEventListener("click",()=>{document.getElementById("codeShow").classList.remove("codeActive")});const a=document.getElementById("codeInput");a.addEventListener("change",()=>{console.log("loading state code:",a.value),a.blur(),I(a.value,t=>this.setState(t))}),a.addEventListener("blur",()=>{document.getElementById("codeLoad").classList.remove("codeActive")});document.getElementById("load").addEventListener("click",()=>{a.value="",a.focus();document.getElementById("codeLoad").classList.add("codeActive")}),this.draw(),this.needsRedraw=!1}getTilingGen(t){return"project"===t?v:"multigrid"===t?y:"wasm"==t?U:(console.error("unknown tiling generator type:",t),y)}initColorControls(t){const e=document.getElementById("controls").clientWidth,s=Math.floor(e/(t-1))+"px",i=document.getElementById("colorControls");let n=0;for(let e=0;e<t-1;e++){let r=document.createElement("div");i.append(r);for(let i=0;i<t-e-1;i++){const t=n++,e=document.createElement("input");e.type="color",e.value=k(this.state.colors[t]),e.style.width=s,e.addEventListener("input",()=>{this.state.colors[t]=M(e.value),this.redraw()}),r.prepend(e)}}}removeColorControls(){const t=document.getElementById("colorControls"),e=t.cloneNode(!1);t.parentNode.replaceChild(e,t)}draw(){this.tilingView.draw(this.state,this.tilingGen),this.axisControls.draw()}redraw(){this.needsRedraw||(this.needsRedraw=!0,window.requestAnimationFrame(()=>{this.needsRedraw=!1,this.draw()}))}updateAxisControls(){this.axisControls.ctls.forEach((t,e)=>{t.x=this.state.basis[0][e],t.y=this.state.basis[1][e]})}axisChanged(t,e,s){this.state.moveAxis(t,e,s),this.updateAxisControls(),this.redraw()}updateOffsetControls(){this.state.offset.forEach((t,e)=>{this.offsetControls.setOffset(e,t)})}offsetChanged(t,e){this.state.offset[t]=e,this.redraw()}translateOffset(t,e){this.state.translateOffset(t,e),this.updateOffsetControls(),this.redraw()}setState(t){this.state=t,document.getElementById("numAxes").value=this.state.dims,this.axisControls.setNumAxes(this.state.dims),this.updateAxisControls(),this.offsetControls.setNumAxes(this.state.dims),this.updateOffsetControls(),this.removeColorControls(),this.initColorControls(this.state.dims),this.redraw()}startAnimation(){this.animating=!0,this.animTime=-1,window.requestAnimationFrame(t=>this.animate(t))}stopAnimation(){this.animating=!1}animate(t){if(!this.animating)return;const e=this.animTime>=0?t-this.animTime:0;this.animTime=t;const s=2*Math.PI/3e4*e;g(this.state.basis[0],0,1,s),g(this.state.basis[1],0,1,s),this.updateAxisControls(),this.draw(),window.requestAnimationFrame(t=>this.animate(t))}}function V(t,e){const s=document.getElementById(t);s.addEventListener("click",()=>{s.classList.toggle("active");const t=document.getElementById(e);"none"===t.style.display?t.style.display="block":t.style.display="none"})}function j(){const t=new D,e=new URLSearchParams(document.location.search);if(e.has("a")){const s=e.get("a").replace(/ /g,"+");console.log("initialising from state code:",s),I(s,e=>t.setState(e))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>j):j()},function(t,e,s){"use strict";(function(t){s.d(e,"b",(function(){return l})),s.d(e,"a",(function(){return d}));var i=s(4);let n=new t("utf-8",{ignoreBOM:!0,fatal:!0});n.decode();let r=null;function o(t,e){return n.decode((null!==r&&r.buffer===i.o.buffer||(r=new Uint8Array(i.o.buffer)),r).subarray(t,t+e))}let a=null;let h=0;function c(t,e){const s=e(8*t.length);return(null!==a&&a.buffer===i.o.buffer||(a=new Float64Array(i.o.buffer)),a).set(t,s/8),h=t.length,s}function l(t,e,s,n,r,o){var a=c(e,i.k),l=h,u=c(s,i.k),d=h,g=c(n,i.k),m=h,p=i.n(t,a,l,u,d,g,m,r,o);return f.__wrap(p)}class u{static __wrap(t){const e=Object.create(u.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,i.a(t)}get key_vert_x(){return i.e(this.ptr)}set key_vert_x(t){i.i(this.ptr,t)}get key_vert_y(){return i.f(this.ptr)}set key_vert_y(t){i.j(this.ptr,t)}get axis1(){return i.c(this.ptr)}set axis1(t){i.g(this.ptr,t)}get axis2(){return i.d(this.ptr)}set axis2(t){i.h(this.ptr,t)}}class f{static __wrap(t){const e=Object.create(f.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,i.b(t)}get_num_faces(){return i.m(this.ptr)>>>0}get_face(t){var e=i.l(this.ptr,t);return u.__wrap(e)}}const d=function(t,e){throw new Error(o(t,e))}}).call(this,s(3).TextDecoder)},function(t,e,s){"use strict";function i(t,e,s){return e<=t&&t<=s}function n(t){if(void 0===t)return{};if(t===Object(t))return t;throw TypeError("Could not convert argument to dictionary")}s.r(e),s.d(e,"TextEncoder",(function(){return h})),s.d(e,"TextDecoder",(function(){return a}));function r(t){this.tokens=[].slice.call(t)}r.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():-1},prepend:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.unshift(e.pop());else this.tokens.unshift(t)},push:function(t){if(Array.isArray(t))for(var e=t;e.length;)this.tokens.push(e.shift());else this.tokens.push(t)}};function o(t,e){if(t)throw TypeError("Decoder error");return e||65533}function a(t,e){if(!(this instanceof a))return new a(t,e);if("utf-8"!==(t=void 0!==t?String(t).toLowerCase():"utf-8"))throw new Error("Encoding not supported. Only utf-8 is supported");e=n(e),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=Boolean(e.fatal),this._ignoreBOM=Boolean(e.ignoreBOM),Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}function h(t,e){if(!(this instanceof h))return new h(t,e);if("utf-8"!==(t=void 0!==t?String(t).toLowerCase():"utf-8"))throw new Error("Encoding not supported. Only utf-8 is supported");e=n(e),this._streaming=!1,this._encoder=null,this._options={fatal:Boolean(e.fatal)},Object.defineProperty(this,"encoding",{value:"utf-8"})}function c(t){var e=t.fatal,s=0,n=0,r=0,a=128,h=191;this.handler=function(t,c){if(-1===c&&0!==r)return r=0,o(e);if(-1===c)return-1;if(0===r){if(i(c,0,127))return c;if(i(c,194,223))r=1,s=c-192;else if(i(c,224,239))224===c&&(a=160),237===c&&(h=159),r=2,s=c-224;else{if(!i(c,240,244))return o(e);240===c&&(a=144),244===c&&(h=143),r=3,s=c-240}return s<<=6*r,null}if(!i(c,a,h))return s=r=n=0,a=128,h=191,t.prepend(c),o(e);if(a=128,h=191,s+=c-128<<6*(r-(n+=1)),n!==r)return null;var l=s;return s=r=n=0,l}}function l(t){t.fatal;this.handler=function(t,e){if(-1===e)return-1;if(i(e,0,127))return e;var s,n;i(e,128,2047)?(s=1,n=192):i(e,2048,65535)?(s=2,n=224):i(e,65536,1114111)&&(s=3,n=240);for(var r=[(e>>6*s)+n];s>0;){var o=e>>6*(s-1);r.push(128|63&o),s-=1}return r}}a.prototype={decode:function(t,e){var s;s="object"==typeof t&&t instanceof ArrayBuffer?new Uint8Array(t):"object"==typeof t&&"buffer"in t&&t.buffer instanceof ArrayBuffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(0),e=n(e),this._streaming||(this._decoder=new c({fatal:this._fatal}),this._BOMseen=!1),this._streaming=Boolean(e.stream);for(var i,o=new r(s),a=[];!o.endOfStream()&&-1!==(i=this._decoder.handler(o,o.read()));)null!==i&&(Array.isArray(i)?a.push.apply(a,i):a.push(i));if(!this._streaming){do{if(-1===(i=this._decoder.handler(o,o.read())))break;null!==i&&(Array.isArray(i)?a.push.apply(a,i):a.push(i))}while(!o.endOfStream());this._decoder=null}return a.length&&(-1===["utf-8"].indexOf(this.encoding)||this._ignoreBOM||this._BOMseen||(65279===a[0]?(this._BOMseen=!0,a.shift()):this._BOMseen=!0)),function(t){for(var e="",s=0;s<t.length;++s){var i=t[s];i<=65535?e+=String.fromCharCode(i):(i-=65536,e+=String.fromCharCode(55296+(i>>10),56320+(1023&i)))}return e}(a)}},h.prototype={encode:function(t,e){t=t?String(t):"",e=n(e),this._streaming||(this._encoder=new l(this._options)),this._streaming=Boolean(e.stream);for(var s,i=[],o=new r(function(t){for(var e=String(t),s=e.length,i=0,n=[];i<s;){var r=e.charCodeAt(i);if(r<55296||r>57343)n.push(r);else if(56320<=r&&r<=57343)n.push(65533);else if(55296<=r&&r<=56319)if(i===s-1)n.push(65533);else{var o=t.charCodeAt(i+1);if(56320<=o&&o<=57343){var a=1023&r,h=1023&o;n.push(65536+(a<<10)+h),i+=1}else n.push(65533)}i+=1}return n}(t));!o.endOfStream()&&-1!==(s=this._encoder.handler(o,o.read()));)Array.isArray(s)?i.push.apply(i,s):i.push(s);if(!this._streaming){for(;-1!==(s=this._encoder.handler(o,o.read()));)Array.isArray(s)?i.push.apply(i,s):i.push(s);this._encoder=null}return new Uint8Array(i)}}},function(t,e,s){"use strict";var i=s.w[t.i];t.exports=i;s(2);i.p()}]]);